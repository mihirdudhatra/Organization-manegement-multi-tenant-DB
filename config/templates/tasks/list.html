{% extends "base/base.html" %}
{% block title %}Tasks{% endblock %}
{% block content %}

{% if project_id %}
<div class="mb-3">
    <a href="{% url 'project-list' %}" class="btn btn-outline-secondary"><i class="fas fa-arrow-left"></i> Back to Projects</a>
</div>
{% endif %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Tasks</h2>
    <a href="{% if project_id %}{% url 'task-create' project_id %}{% else %}{% url 'task-create' 0 %}{% endif %}" class="btn btn-primary"><i class="fas fa-plus"></i> Create Task</a>
</div>

{% if tasks %}
<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Status</th>
                <th>Assigned To</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td><a href="{% url 'task-detail' task.id %}">{{ task.title }}</a></td>
                <td>{{ task.description }}</td>
                <td>
                    <span class="badge 
                        {% if task.status == 'OPEN' %}bg-secondary
                        {% elif task.status == 'IN_PROGRESS' %}bg-primary
                        {% elif task.status == 'BLOCKED' %}bg-warning
                        {% elif task.status == 'DONE' %}bg-success{% endif %}">
                        {{ task.get_status_display }}
                    </span>
                </td>
                <td>{{ task.assigned_to|default:"Unassigned" }}</td>
                <td>
                    <form method="post" action="{% url 'task-status-update' task.id %}" class="d-inline">
                        {% csrf_token %}
                        <select name="status" class="form-select form-select-sm d-inline w-auto" onchange="this.form.submit()">
                            <option value="OPEN" {% if task.status == 'OPEN' %}selected{% endif %}>Open</option>
                            <option value="IN_PROGRESS" {% if task.status == 'IN_PROGRESS' %}selected{% endif %}>In Progress</option>
                            <option value="BLOCKED" {% if task.status == 'BLOCKED' %}selected{% endif %}>Blocked</option>
                            <option value="DONE" {% if task.status == 'DONE' %}selected{% endif %}>Done</option>
                        </select>
                    </form>
                    <!-- <a href="{% url 'task-update' task.id %}" class="btn btn-outline-secondary btn-sm ms-1">Edit</a> -->
                    <a href="{% url 'task-delete' task.id %}" class="btn btn-outline-danger btn-sm ms-1">Delete</a>
                    <a href="{% url 'task-audit-ui' task.id %}" class="btn btn-outline-info btn-sm ms-1">Audit</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info">No tasks found. <a href="{% if project_id %}{% url 'task-create' project_id %}{% else %}{% url 'task-create' 0 %}{% endif %}">Create one</a></div>
{% endif %}

{% endblock %}
