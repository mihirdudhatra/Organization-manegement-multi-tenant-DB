{% extends "base/base.html" %}
{% block title %}Task Detail{% endblock %}
{% block content %}

<div class="mb-3">
    <a href="{% url 'task-list-ui' %}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Back to Tasks
    </a>
</div>

<div class="card">
    <div class="card-header">
        <h3>{{ task.title }}</h3>
    </div>

    <div class="card-body">
        <p><strong>Description:</strong> {{ task.description|linebreaks }}</p>

        <p>
            <strong>Status:</strong>
            {% if current_role != "MEMBER" or task.assigned_to == current_user_id %}
            <select name="status"
                    class="form-select form-select-sm d-inline w-auto"
                    onchange="this.form.submit()">
                <option value="OPEN" {% if task.status == "OPEN" %}selected{% endif %}>Open</option>
                <option value="IN_PROGRESS" {% if task.status == "IN_PROGRESS" %}selected{% endif %}>In Progress</option>
                <option value="BLOCKED" {% if task.status == "BLOCKED" %}selected{% endif %}>Blocked</option>
                <option value="DONE" {% if task.status == "DONE" %}selected{% endif %}>Done</option>
            </select>
        {% endif %}
        </p>

        <div class="mb-3">
            <label for="assigned_to" class="form-label"><strong>Assigned To</strong></label>
            <select name="assigned_to"
                    class="form-select w-auto"
                    onchange="this.form.submit()">

                <option value="">Unassigned</option>

                {% for user in users %}
                <option value="{{ user.id }}"
                        {% if task.assigned_to == user.id %}
                        selected
                        {% endif %}>
                    {{ user.username }}
                </option>
                {% endfor %}
            </select>
        </div>

        <p><strong>Created At:</strong> {{ task.created_at }}</p>
        <p><strong>Project:</strong> {{ task.project_name }}</p>
    </div>

    <div class="card-footer">
        <a href="{% url 'task-delete' task.id %}" class="btn btn-danger">Delete</a>
    </div>
</div>

{% endblock %}
